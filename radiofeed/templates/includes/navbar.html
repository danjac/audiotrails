{% load i18n static %}
{% with site_name=request.site.name %}
    <header class="sticky top-0 z-20 w-full text-white bg-black shadow"
        x-data="{sidebar: false}"
        @htmx:before-request.window="sidebar=false">
        {% translate "Search" as t_search %}
        {% translate "Toggle Menu" as t_toggle_menu %}
        {% url 'podcasts:search_podcasts' as search_url %}
        <nav class="flex items-center justify-between p-2">
            <div class="flex items-center flex-shrink-0 space-x-3">
                <a class="inline-flex items-center text-lg font-bold md:text-xl xl:text-2xl"
                    href="{% if user.is_authenticated %}{% url 'podcasts:index' %}{% else %}{% url 'podcasts:landing_page' %}{% endif %}"
                    title="{{ site_name }}: {% translate "Home Page" %}">
                    <img src="{% static 'img/wave.png' %}"
                        height="100"
                        width="100"
                        alt="{{ site_name }}"
                        class="w-6 h-6 mr-2 lg:h-8 lg:w-8"
                        title="{{ site_name }}"
                        aria-hidden="true">
                    {{ site_name }}
                </a>
            </div>
            {% if user.is_authenticated %}
                <form action="{{ search_url }}"
                    method="get"
                    class="relative hidden bg-transparent sm:block"
                    x-data="{search: ''}"
                    @submit="$refs.search.blur();"
                    @htmx:before-request.window="search=''">
                    <input type="search"
                        x-ref="search"
                        x-model="search"
                        @click="$el.select()"
                        name="{{ request.search.param }}"
                        accesskey="k"
                        autocomplete="off"
                        aria-label="{{ t_search }}"
                        placeholder="{{ t_search }}"
                        class="w-64 px-4 py-1 text-sm text-gray-900 rounded md:w-72 focus:outline-none focus:ring placeholder-opacity-100 dark:text-white dark:bg-gray-900 md:text-base">
                    <div class="absolute inset-y-0 right-0 flex items-center pr-2">
                        <button type="submit"
                            title="{{ t_search }}"
                            class="text-gray-900 focus:outline-none focus:shadow-outline dark:text-gray-100">
                            {% icon "search" title=t_search %}
                        </button>
                    </div>
                </form>
            {% endif %}
            <ul class="flex items-center space-x-3">
                {% if user.is_authenticated %}
                    <li>
                        <a href="{% url 'users:preferences' %}"
                            title="{% blocktranslate with username=user.username %}Settings for {{ username }}{% endblocktranslate %}"
                            class="flex items-center font-bold">
                            {{ user.username|slice:12 }}
                        </a>
                    </li>
                    <li class="flex items-center xl:hidden">
                        <button class="focus:outline-none transform transition"
                            title="{{ t_toggle_menu }}"
                            x-cloak
                            x-show.transition="!sidebar"
                            @click="sidebar=true">
                            {% icon "bars" size="xl" title=t_toggle_menu %}
                        </button>
                        <button class="focus:outline-none transform transition"
                            title="{{ t_toggle_menu }}"
                            x-cloak
                            x-show.transition="sidebar"
                            @click="sidebar=false">
                            {% icon "chevron-down" size="xl" title=t_toggle_menu %}
                        </button>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'about' %}"
                            title="{% translate "About this Site" %}"
                            class="flex items-center font-bold space-x-2">
                            {% icon "info-circle" size="xl" %}
                            <span class="hidden md:inline-block">{% translate "About" %}</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% if user.is_authenticated %}
            <div class="absolute left-0 z-50 w-full py-6 bg-white shadow-xl xl:hidden dark:bg-black top-15"
                x-cloak
                x-show.transition="sidebar"
                x-transition:enter="transition ease-out duration-100"
                x-transition:enter-start="transform opacity-0 scale-95"
                x-transition:enter-end="transform opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-75"
                x-transition:leave-start="transform opacity-100 scale-100"
                x-transition:leave-end="transform opacity-0 scale-95">
                <div class="flex justify-center mb-6 sm:hidden"
                    @click.away="sidebar=false">
                    <form action="{{ search_url }}"
                        method="get"
                        class="relative bg-transparent"
                        x-data="{search: ''}"
                        @htmx:before-request.window="search=''">
                        <input type="search"
                            x-model="search"
                            @click="$el.select()"
                            name="{{ request.search.param }}"
                            autocomplete="off"
                            aria-label="{{ t_search }}"
                            placeholder="{{ t_search }}"
                            class="w-64 px-4 py-1 text-sm text-gray-900 rounded focus:outline-none focus:ring placeholder-opacity-100 dark:bg-gray-900 dark:text-white">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-2">
                            <button type="submit"
                                title="{{ t_search }}"
                                class="text-gray-900  focus:outline-none focus:shadow-outline dark:text-gray-100">
                                {% icon "search" title=t_search %}
                            </button>
                        </div>
                    </form>
                </div>
                {% include "includes/sidebar.html" %}
            </div>
        {% endif %}
        {% include "includes/signup_cta.html" %}
    </header>
{% endwith %}
