services:
    database:
        image: postgres:15.0-bullseye
        environment:
            POSTGRES_PASSWORD: password
        volumes:
            - pg_data:/var/lib/postgresql/data
        ports:
            - 5432:5432
steps:
    frontend:
        image: node:20-buster
        commands:
            - npm install
            - npm run lint
        when:
            - event: push
              branch: main
    backend:
        image: python:3.11.4-buster
        commands:
            - apt-get install libpq-dev
            - pip install -r requirements-ci.txt
            - python -m ruff radiofeed
            - python -m djlint --lint templates/
            - xargs python -m nltk.downloader < nltk.txt
            - python -m pytest
        when:
            - event: push
              branch: main
