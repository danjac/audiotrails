name: deploy:dokku

on:
    workflow_dispatch:

jobs:
    runchecks:
        uses: ./.github/workflows/checks.yml
    deploy:
        needs: runchecks
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3.5.2
              with:
                  fetch-depth: 0

            - name: Deploy to Dokku
              uses: vitalyliber/dokku-github-action@v7.1
              env:
                  PRIVATE_KEY: ${{ secrets.DOKKU_SSH_PRIVATE_KEY }}
                  HOST: ${{ secrets.DOKKU_HOST }}
                  PROJECT: ${{ secrets.DOKKU_APP }}
                  BRANCH: main
