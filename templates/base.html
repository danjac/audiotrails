{% spaceless %}
    {% load static django_htmx player %}

    {% if not request.htmx %}
        <!DOCTYPE html>
        <html lang="en">
            <!--
__________          .______________                     __
\______   \____   __| _/\__    ___/___________    ____ |  | __ ___________
 |     ___/  _ \ / __ |   |    |  \_  __ \__  \ _/ ___\|  |/ // __ \_  __ \
 |    |  (  <_> ) /_/ |   |    |   |  | \// __ \\  \___|    <\  ___/|  | \/
 |____|   \____/\____ |   |____|   |__|  (____  /\___  >__|_ \\___  >__|
                     \/                       \/     \/     \/    \/
    -->
            <head>
    {% endif %}

    <title>
        {{ request.site.name }}{% block title %}{% endblock %}
    </title>

    {% if request.htmx %}
        {% include "partials/signup_cta.html" with hx_oob=True %}
    {% else %}
        {% include "partials/meta.html" %}

        <link rel="icon"
            type="image/png"
            href="{% static 'img/wave-ico.png' %}">

        <link rel="apple-touch-icon image_src"
            href="{% static 'img/apple-touch-icon.png' %}">

        <link rel="stylesheet"
            media="screen"
            href="{% static 'dist/bundle.css' %}{% if debug %}?{% now 'U' %}{% endif %}">

        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "WebSite",
                "url": "{% absolute_uri 'podcasts:index' %}",
                "potentialAction": {
                    "@type": "SearchAction",
                    "target": {
                        "@type": "EntryPoint",
                        "urlTemplate": "{% absolute_uri 'podcasts:search_podcasts' %}?q={search_term_string}"
                    },
                    "query-input": "required name=search_term_string"
                }
            }
        </script>
        </head>

        <body class="container-xl mx-auto antialiased font-sans dark:bg-zinc-900 dark:text-white text-sm md:text-base scroll-smooth"
            hx-boost="true"
            hx-target="#layout"
            hx-swap="outerHTML show:window:top"
            hx-indicator="#loader"
            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
            {% include "partials/hx_indicator.html" %}

            <div class="flex flex-col h-screen">
                <div class="flex-grow">
                    {% include "partials/navbar.html" %}

    {% endif %}

    {% include "partials/messages.html" with hx_oob=request.htmx %}

    <div hx-history-elt
        id="layout"
        class="flex relative p-2 pt-6 mx-auto xl:w-5/6 min-h-screen">
        <aside class="w-full hidden xl:block xl:w-1/5 xl:sticky xl:h-full xl:top-16">
            {% include "partials/sidebar.html" %}
        </aside>

        <main class="w-full xl:block md:w-4/5 md:mx-auto">
            {% block content %}{% endblock %}
        </main>
    </div>
    {% if not request.htmx %}
        </div>
        {% cookie_notice %}

        {% if user.is_authenticated %}
            <div id="player">
                {% audio_player %}
            </div>
        {% endif %}

        {% include "partials/footer.html" %}
        </div>

        {% django_htmx_script %}

        <script defer src="{% static 'dist/bundle.js' %}{% if debug %}?{% now 'U' %}{% endif %}"></script>

        </body>

        </html>
    {% endif %}

{% endspaceless %}
