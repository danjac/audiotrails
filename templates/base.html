{% spaceless %}
    {% load static django_htmx player solo_tags %}

{% get_solo 'settings.SiteConfiguration' as site_config %}

    {% if not request.htmx %}
        <!DOCTYPE html>
        <html lang="en">
            <!--
__________             .___.__        _____                 .___
\______   \_____     __| _/|__| _____/ ____\____   ____   __| _/
 |       _/\__  \   / __ | |  |/  _ \   __\/ __ \_/ __ \ / __ |
 |    |   \ / __ \_/ /_/ | |  (  <_> )  | \  ___/\  ___// /_/ |
 |____|_  /(____  /\____ | |__|\____/|__|  \___  >\___  >____ |
        \/      \/      \/                     \/     \/     \/
    -->
            <head>
    {% endif %}

    <title>
        {{ site_config.site_name }}{% block title %}{% endblock %}
    </title>

    {% if request.htmx %}
        {% include "partials/signup_cta.html" with hx_oob=True %}
    {% else %}
        <link rel="icon"
            type="image/png"
            href="{% static 'img/wave-ico.png' %}">

        <link rel="apple-touch-icon image_src"
            href="{% static 'img/apple-touch-icon.png' %}">

        <link rel="stylesheet"
            media="screen"
            href="{% static 'dist/bundle.css' %}{% if debug %}?{% now 'U' %}{% endif %}">

        <meta charset="UTF-8">

        <meta http-equiv="X-UA-Compatible"
            content="IE=edge" />
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="copyright"
            content="Dan Jacob {% now "Y" %}">
        <meta name="htmx-config"
            content='{"historyCacheSize": 0, "refreshOnHistoryMiss": false}'>
        <meta name="Cache-Control"
            content="no-cache">
        <meta name="robots"
            content="index,follow">

        {% block content_metadata %}
        {% with site_description=site_config.description|escapejs site_name=site_config.site_name|escapejs %}

            {% if site_description %}
            <meta name="description"
                  content="{{ site_description }}" />
            {% endif %}

            {% if site_config.keywords %}
            <meta name="keywords"
                  content="{{ site_config.keywords|escapejs }}" />
            {% endif %}

            <meta name="og:type"
                content="website" />
            <meta name="og:title"
                content="{{ site_name }}" />
            {% if site_description %}
            <meta name="og:description"
                  content="{{ site_description }}" />
            {% endif %}
            <meta name="og:url"
                content="{% absolute_uri 'podcasts:index' %}" />
            {% if site_description %}
             <meta name="twitter:description"
                  content="{{ site_description }}">
             {% endif %}
            <meta name="twitter:card"
                content="summary">
            {% if site_config.twitter_handle %}
                <meta name="twitter:site"
                    content="@{{ site_config.twitter_handle }}">
            {% endif %}
            <meta name="twitter:title"
                content="{{ site_name }}">
            <script type="application/ld+json">
                {
                    "@context": "https://schema.org",
                    "@type": "WebSite",
                    "url": "{% absolute_uri 'podcasts:index' %}",
                    "potentialAction": {
                        "@type": "SearchAction",
                        "target": {
                            "@type": "EntryPoint",
                            "urlTemplate": "{% absolute_uri 'podcasts:search_podcasts' %}?q={search_term_string}"
                        },
                        "query-input": "required name=search_term_string"
                    }
                }
            </script>
            {% endwith %}
        {% endblock content_metadata %}
        </head>

        <body class="container-xl mx-auto antialiased font-sans dark:bg-zinc-900 dark:text-white text-sm md:text-base scroll-smooth"
            hx-boost="true"
            hx-target="#layout"
            hx-swap="outerHTML show:window:top"
            hx-indicator="#loader"
            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
            {% include "partials/hx_indicator.html" %}

            <div class="flex flex-col h-screen">
                <div class="flex-grow">
                    {% include "partials/navbar.html" %}

    {% endif %}

    {% include "partials/messages.html" with hx_oob=request.htmx %}

    <div hx-history-elt
        id="layout"
        class="flex relative p-2 pt-6 mx-auto xl:w-5/6 min-h-screen">
        <aside class="w-full hidden xl:block xl:w-1/5 xl:sticky xl:h-full xl:top-16">
            {% include "partials/sidebar.html" %}
        </aside>

        <main class="w-full xl:block md:w-4/5 md:mx-auto">
            {% block content %}{% endblock %}
        </main>
    </div>
    {% if not request.htmx %}
        </div>
        {% cookie_notice %}

        {% if user.is_authenticated %}
            <div id="player">
                {% audio_player %}
            </div>
        {% endif %}

        {% include "partials/footer.html" %}
        </div>

        {% django_htmx_script %}

        <script defer src="{% static 'dist/bundle.js' %}{% if debug %}?{% now 'U' %}{% endif %}"></script>

        </body>

        </html>
    {% endif %}

{% endspaceless %}
