{% load heroicons partials %}
<form class="relative bg-transparent"
      method="get"
      action="{{ search_url }}"
      x-init="$watch('search', value => $dispatch('search', value))"
      x-data="{search: '{{ request.search.value|escapejs }}'}">
    <input type="search"
           name="{{ request.search.param }}"
           class="py-1 px-2 w-64 placeholder-opacity-100 text-gray-900 rounded dark:text-white dark:bg-gray-900 focus:ring focus:outline-none"
           autocomplete="off"
           placeholder="{{ placeholder }}"
           aria-label="{{ placeholder }}"
           hx-validate="true"
           x-model="search"
           @keydown.ctrl.k.window.prevent="$el.focus()"
           :class="{ 'md:w-72 xl:w-84': !search, 'md:w-72 xl:w-96': search }">
    <div class="flex absolute inset-y-0 right-0 items-center pr-2">
        {% if request.search and clear_search %}
            <a href="{{ request.path }}"
               title="Clear Search"
               aria-label="Clear Search"
               class="mr-2 text-gray-900 dark:text-gray-100 focus:outline-none focus:shadow-outline">{% heroicon_mini "backspace" title="Clear Search" %}</a>
        {% else %}
            <button title="Clear Search"
                    aria-label="Clear Search"
                    type="button"
                    class="mr-2 text-gray-900 dark:text-gray-100 focus:outline-none focus:shadow-outline"
                    x-show="search"
                    @click.prevent="search=''">{% heroicon_mini "backspace" title="Clear Search" %}</button>
        {% endif %}
        <button type="submit"
                title="Search"
                aria-label="Search"
                :disabled="!search"
                class="text-gray-900 dark:text-gray-100 focus:outline-none focus:shadow-outline">
            {% heroicon_mini "magnifying-glass" title="Search" %}
        </button>
    </div>
</form>
{% partialdef button %}
    <button class="inline-flex items-center btn btn-default"
        tabindex="0"
        {# djlint: off #}
        x-data="{
            url: '{{ search_url|escapejs }}',
            search: '{{ request.search.value|escapejs }}',
            get searchUrl() {
                const params = new URLSearchParams();
                params.append('{{ request.search.param }}', this.search);
                return `${this.url}?${params.toString()}`;
            },
        }"
        {# djlint: on #}
        hx-push-url="true"
        :hx-get="searchUrl"
        :disabled="!search"
        @search.window="search=$event.detail; $nextTick(() => htmx.process($el));"
        >
        {% heroicon_mini "magnifying-glass" class="mr-2" %}
        {{ text }}
    </button>
{% endpartialdef %}
