{% with podcast=episode.podcast episode_url=episode.get_absolute_url %}
  <div class="border dark:border-gray-500 mb-4"
    {% if hx_remove %}
      x-data="{show: true, showDetails: false}"
      x-show="show"
      x-transition:leave="transition ease-out duration-500"
      x-transition:leave-start="transform opacity-100"
      x-transition:leave-end="transform opacity-0"
      @{{ hx_remove }}.window="if ($event.detail.value === {{ episode.id }}) show=false"
    {% else %}
      x-data="{showDetails: false}"
    {% endif %}
    @toggle-episode-details.window="
    if ($event.detail.show && $event.detail.id === {{ episode.id }}) {
    showDetails = true;
    } else {
    showDetails = false;
    }
    ">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2 sm:space-x-3">

        {% block cover_image %}
          <div class="w-20">
            {% if is_podcast_detail %}
              <a href="{{ episode_url }}">
                {% include "_cover_image.html" with cover_url=episode.get_cover_url alt=episode.cleaned_title size=20 css_class=COVER_IMAGE_CSS %}
              </a>
            {% else %}
              <a href="{{ podcast.get_absolute_url }}">
                {% include "_cover_image.html" with cover_url=podcast.cover_url alt=podcast.cleaned_title size=20 css_class=COVER_IMAGE_CSS %}
              </a>
            {% endif %}
          </div>
        {% endblock cover_image %}

        <div class="flex flex-col place-content-between h-16">
          <h2 class="w-52 max-h-10 flex flex-wrap break-words overflow-y-hidden sm:block sm:truncate sm:w-auto sm:max-w-md md:max-w-lg lg:max-w-xl xl:max-w-2xl 2xl:max-w-3xl">
            <a href="{{ episode_url }}"
              class="link"
              title="{{ episode.cleaned_title }}">
              {{ episode.cleaned_title }}
            </a>
          </h2>
          <div class="flex items-center space-x-2">
            {% if is_podcast_detail %}
              <div class="font-semibold text-gray-600 dark:text-gray-300 text-xs lg:text-sm">
                {% include "_date.html" with value=episode.pub_date %}
              </div>
            {% else %}
              <h3 class="truncate w-52 sm:w-auto sm:max-w-md md:max-w-lg lg:max-w-xl xl:max-w-2xl 2xl:max-w-3xl">
                <a href="{{ podcast.get_episodes_url }}"
                  class="link text-xs lg:text-sm text-gray-600 dark:text-gray-300 font-semibold"
                  title="{{ podcast.cleaned_title }}">
                  {{ podcast.cleaned_title }}
                </a>
              </h3>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="pr-3 flex items-center space-x-1 md:space-x-2">
        {% block actions %}
          <div class="flex items-center">
            <button title="More Details"
              @click="$dispatch('toggle-episode-details', { id: {{ episode.id }}, show: !showDetails })">
              {% icon "info" css_class="w-6 h-6" %}
            </button>
          </div>
          {% include "episodes/_actions_toggle.html" %}
        {% endblock actions %}
      </div>
    </div>
    <div class="p-2 border-t mt-3 mx-1 dark:border-gray-500"
      x-cloak
      x-show="showDetails"
      x-transition:leave="transition ease-out duration-500"
      x-transition:leave-start="transform opacity-100"
      x-transition:leave-end="transform opacity-0">
      {% include "_markdown.html" with content=episode.description %}
    </div>
  </div>
{% endwith %}
