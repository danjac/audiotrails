{% extends "episodes/base.html" %}

{% block subtitle %} | {{ episode.podcast.cleaned_title }} | {{ episode.cleaned_title }}{% endblock %}

{% block content %}

<h1 class="font-bold text-lg md:text-xl mb-3">{{ episode.cleaned_title }}</h1>

{% with podcast=episode.podcast duration=episode.get_duration_in_seconds podcast_url=episode.podcast.get_absolute_url %}

{% with prev_episode=episode.get_previous_episode next_episode=episode.get_next_episode %}
{% if prev_episode or next_episode %}
<nav class="flex justify-between mb-3 border-b dark:border-gray-500 pb-3 text-sm lg:text-base">
  {% if prev_episode %}
  <a class="link"
     href="{{ prev_episode.get_absolute_url }}"
     title="{{ prev_episode.cleaned_title }}">
    Previous
  </a>

  {% else %}
  <span class="inactive-link">Previous</span>
  {% endif %}
  {% if next_episode %}
  <a class="link"
     href="{{ next_episode.get_absolute_url }}"
     title="{{ next_episode.cleaned_title }}">
    Next
  </a>
  {% else %}
  <span class="inactive-link">Next</span>
  {% endif %}

</nav>
{% endif %}
{% endwith %}

<section class="space-y-3 pb-3 mb-3">
  <div>
    <a href="{{ podcast_url }}"
       title="{{ podcast.cleaned_title }}"
       class="link lg:text-lg">
      {{ podcast.cleaned_title }}
    </a>
  </div>

  <div class="flex items-center space-x-3 lg:space-x-4">
    <div>
      <a href="{{ podcast_url }}">
        {% include "_cover_image.html" with cover_url=episode.get_cover_url alt=episode.cleaned_title size=28 css_class="h-24 w-24 lg:h-28 lg:w-28" css_class="h-24 w-24 lg:h-28 lg:w-28" %}
      </a>
    </div>
    <div class="space-y-2 lg:space-y-3 text-sm lg:text-base">
      {% if user.is_authenticated %}
      <div x-data="{isPlaying: {{ is_playing|yesno:'true,false' }}}"
           x-cloak
           @close-player.window="isPlaying=false"
           @play-episode.window="isPlaying=$event.detail.value==={{ episode.id }}">
        <button class="flex items-center btn btn-secondary"
                x-show="isPlaying"
                hx-post="{% url 'episodes:close_player' %}"
                hx-push-url="false"
                hx-target="#player"
                hx-swap="innerHTML">
          {% icon "stop" css_class="btn-icon mr-2" %}
          Close Player
        </button>

        <button class="flex items-center btn btn-default"
                x-show="!isPlaying"
                hx-post="{% url 'episodes:start_player' episode.id %}"
                hx-push-url="false"
                hx-target="#player"
                hx-swap="innerHTML">
          {% icon "play" css_class="btn-icon mr-2" %}
          {% if episode.completed %}Re-Play{% elif episode.listened %}Resume{% else %}Play{% endif %}
        </button>
      </div>
      {% else %}
      <div>
        <button class="flex items-center btn btn-default" disabled title="You must sign up or log in to play this episode">
          {% icon "play" css_class="h-6 w-6 mr-2" %}
          Play
        </button>
      </div>
      {% endif %}
      {% share_buttons episode.get_absolute_url podcast.cleaned_title|add:" | "|add:episode.cleaned_title %}
      {% include "episodes/_actions_toggle.html" with is_detail=True %}
    </div>
  </div>

  <div class="flex items-center font-semibold text-gray-600 dark:text-gray-300 space-x-3 text-sm lg:text-base">
    <div title="Date Published">
      {% include "_pub_date.html" with pub_date=episode.pub_date %}
    </div>
    <div title="Duration">
      {{ duration|format_duration }}
    </div>
  </div>
  {% if episode.listened %}
  {% include "episodes/_listened.html" %}
  {% endif %}

  {% if episode.explicit or podcast.explicit %}
  <div class="font-semibold text-sm lg:text-base">
    This episode may contain explicit content.
  </div>
  {% endif %}

  <blockquote class="markdown max-w-sm sm:max-w-full text-sm lg:text-base">
    {{ episode.description|clean_html }}
  </blockquote>

  {% include "podcasts/_disclaimer.html" %}

</section>
{% endwith %}
{% endblock %}
