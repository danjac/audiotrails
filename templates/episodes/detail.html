{% extends "base.html" %}
{% load cache heroicons %}
{% block title %}
    {{ block.super }} | {{ episode.podcast.cleaned_title }} | {{ episode.cleaned_title }}
{% endblock title %}
{% block content %}
    <header class="pb-3 mb-3 space-y-6 border-b">
        <h1 class="text-xl font-bold lg:text-2xl">{{ episode.cleaned_title }}</h1>
        {% cache 300 episode-nav-header episode.pk %}
        {% with next_episode=episode.get_next_episode previous_episode=episode.get_previous_episode %}
            {% if next_episode or previous_episode %}
                <nav>
                    <ul class="flex justify-between" aria-label="Pagination">
                        <li>
                            {% if previous_episode %}
                                <a class="link"
                                   href="{{ previous_episode.get_absolute_url }}"
                                   aria-label="{{ previous_episode.cleaned_title }}"
                                   title="{{ previous_episode.cleaned_title }}">Previous</a>
                            {% else %}
                                <span class="text-gray-600 cursor-not-allowed dark:text-gray-300"
                                      title="First Episode"
                                      aria-label="First Episode">Previous</span>
                            {% endif %}
                        </li>
                        <li>
                            {% if next_episode %}
                                <a class="link"
                                   href="{{ next_episode.get_absolute_url }}"
                                   aria-label="{{ next_episode.cleaned_title }}"
                                   title="{{ next_episode.cleaned_title }}">Next</a>
                            {% else %}
                                <span class="text-gray-600 cursor-not-allowed dark:text-gray-300"
                                      title="Last Episode"
                                      aria-label="Last Episode">Next</span>
                            {% endif %}
                        </li>
                    </ul>
                </nav>
            {% endif %}
        {% endwith %}
    {% endcache %}
</header>
{% with podcast=episode.podcast %}
    <article class="space-y-3" x-data>
        <h2 class="text-lg font-semibold">
            <a href="{{ podcast.get_absolute_url }}"
               class="link"
               title="{{ podcast.cleaned_title }}">{{ podcast.cleaned_title }}</a>
        </h2>
        {% with episode_type=episode.get_episode_type episode_num=episode.episode season=episode.season %}
            <div class="flex flex-wrap items-center space-x-3 font-semibold text-gray-800 dark:text-gray-300">
                {% if episode_type %}<span>{{ episode_type|capfirst }}</span>{% endif %}
                {% if episode_num %}<span>Episode {{ episode_num }}</span>{% endif %}
                {% if season %}<span>Season {{ season }}</span>{% endif %}
                <a href="{{ podcast.get_episodes_url }}"
                   title="See all episodes for {{ podcast.cleaned_title }}"
                   class="inline-block link">See all episodes</a>
            </div>
        {% endwith %}
        <div class="flex items-center space-x-3 sm:space-x-6">
            {% cover_image episode.get_cover_url "detail" podcast.cleaned_title css_class="h-36 w-36 lg:h-40 lg:w-40" %}
            <div class="flex flex-col place-content-between h-32">
                {% include "episodes/_audio_player_button.html" %}
                {% include "episodes/_bookmark_button.html" %}
                <div class="flex flex-wrap items-center space-x-2 font-semibold text-gray-800 sm:space-x-3 dark:text-gray-300">
                    <a download
                       aria-label="Download audio file to your device"
                       title="Download audio file to your device"
                       href="{{ episode.media_url }}"
                       target="_blank"
                       class="link">Download</a>
                    {% with website=episode.website|default:podcast.website %}
                        {% if website %}
                            <a href="{{ website }}"
                               target="_blank"
                               rel="noopener"
                               class="link"
                               title="Link to Website">Website</a>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>
        {% if episode.is_explicit %}
            <div title="May contain adult themes and language. Listener discretion advised."
                 class="flex items-center space-x-2 font-bold text-red-600 dark:text-red-500">
                {% heroicon_outline "exclamation-triangle" size=20 %} <span class="inline-block">Explicit</span>
            </div>
        {% endif %}
        <div class="flex flex-wrap items-center space-x-3 font-semibold text-gray-600 dark:text-gray-300">
            <div>{% include "_date.html" with value=episode.pub_date title="Released" %}</div>
            {% with duration=episode.duration_in_seconds %}
                {% if duration %}<div title="Duration">{{ duration|format_duration }}</div>{% endif %}
            {% endwith %}
            {% with file_size=episode.get_file_size %}
                {% if file_size %}<div title="File Size">{{ file_size }}</div>{% endif %}
            {% endwith %}
        </div>
        {% include "episodes/_audio_log.html" %}
        {% include "_markdown.html" with content=episode.description %}
    </article>
{% endwith %}
{% endblock content %}
