{% extends "episodes/base.html" %}

{% block subtitle %} | {{ episode.podcast.cleaned_title }} | {{ episode.cleaned_title }}{% endblock %}

{% block content %}
<h1 class="font-bold lg:text-lg mb-3">{{ episode.cleaned_title }}</h1>

{% with podcast=episode.podcast duration=episode.duration_in_seconds %}

{% if previous_episode or next_episode %}
<nav class="flex justify-between mb-3 border-b dark:border-gray-500 pb-3 text-sm">
  {% if previous_episode %}
  <a class="link"
     href="{{ previous_episode.get_absolute_url }}"
     title="{{ previous_episode.cleaned_title }}">
    Previous
  </a>

  {% else %}
  <span class="text-gray-600 cursor-not-allowed">Previous</span>
  {% endif %}
  {% if next_episode %}
  <a class="link"
     href="{{ next_episode.get_absolute_url }}"
     title="{{ next_episode.cleaned_title }}">
    Next
  </a>
  {% else %}
  <span class="text-gray-600 cursor-not-allowed">Next</span>
  {% endif %}

</nav>
{% endif %}

<div class="space-y-3 pb-3 mb-3">
  <div>
    <a href="{{ podcast.get_episodes_url }}"
       title="{{ podcast.cleaned_title }}"
       class="link text-sm">
      {{ podcast.cleaned_title }}
    </a>
  </div>

  {% with metadata=episode.get_episode_metadata %}
  {% if metadata %}
  <div class="font-semibold text-gray-800 dark:text-gray-300 text-sm">
    {{ metadata }}
  </div>
  {% endif %}
  {% endwith %}

  <div class="flex items-center space-x-3">
    <div>
      <a href="{{ podcast.get_detail_url }}">
        {% include "_cover_image.html" with cover_url=episode.get_cover_url alt=episode.cleaned_title size=28 css_class="h-28 w-28" %}
      </a>
    </div>
    <div class="flex flex-col place-content-between h-24 text-sm">

      {% include "episodes/_play_toggle.html" %}

      {% share_buttons episode.get_absolute_url podcast.cleaned_title|add:" | "|add:episode.cleaned_title %}

      <div>
        {% if user.is_authenticated %}
        {% include "episodes/_actions_toggle.html" with is_detail=True %}
        {% else %}
        {% with file_size=episode.get_file_size %}
        <a class="inline-block link"
           download
           href="{{ episode.media_url }}">Download {{ episode.get_media_url_ext|upper }}</a>
        {% endwith %}
        {% endif %}
      </div>
    </div>
  </div>

  <div class="flex items-center flex-wrap font-semibold text-gray-800 dark:text-gray-300 space-x-3 text-sm">
    <div title="Date Published">
      {% include "_pub_date.html" with pub_date=episode.pub_date %}
    </div>
    {% if duration %}
    <div title="Duration">
      {{ duration|format_duration }}
    </div>
    {% endif %}
    {% with file_size=episode.get_file_size %}
    {% if file_size %}
    <div title="Size">
      {{ file_size }}
    </div>
    {% endif %}
    {% endwith %}
    {% if episode.explicit or podcast.explicit %}
    <div class="flex items-center"
         title="May contain adult themes and language. Listener discretion advised.">
      {% icon "warning" css_class="h-4 w-4 h-4 w-4 mr-2" %}
      Explicit
    </div>
    {% endif %}
  </div>
  {% if episode.listened %}
  {% include "episodes/_listened.html" %}
  {% endif %}

  {% include "_markdown.html" with content=episode.description %}
  {% include "podcasts/_disclaimer.html" with explicit=episode.explicit|default:podcast.explicit %}

</div>
{% endwith %}
{% endblock %}
