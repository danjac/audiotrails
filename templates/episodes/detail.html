{% extends "episodes/base.html" %}

{% block subtitle %} | {{ episode.podcast.title|stripentities }} | {{ episode.title|stripentities }}{% endblock %}

{% block content %}

{% with prev_episode=episode.get_previous_episode next_episode=episode.get_next_episode %}
{% if prev_episode or next_episode %}
<nav class="text-sm flex justify-between mb-3 border-b dark:border-gray-500 sm:border-0 pb-3 sm:pb-0">
  {% if prev_episode %}
  <a class="link"
     href="{{ prev_episode.get_absolute_url }}"
     title="{{ prev_episode.title|stripentities }}">
    Previous
  </a>

  {% else %}
  <span class="inactive-link">Previous</span>
  {% endif %}
  {% if next_episode %}
  <a class="link"
     href="{{ next_episode.get_absolute_url }}"
     title="{{ next_episode.title|stripentities }}">
    Next
  </a>
  {% else %}
  <span class="inactive-link">Next</span>
  {% endif %}

</nav>
{% endif %}
{% endwith %}

{% with podcast=episode.podcast duration=episode.get_duration_in_seconds %}
<section class="sm:p-2 sm:border dark:border-gray-500 space-y-3"
         hx-get="{{ episode.get_absolute_url }}"
         hx-target="#content"
         hx-trigger="reload-episode-{{ episode.id }} from:body">

  <h1 class="font-bold">{{ episode.title|stripentities }}</h1>
  <h2>
    <a href="{{ podcast.get_absolute_url }}"
       title="{{ podcast.title|stripentities }}"
       class="link text-sm">
      {{ podcast.title|stripentities }}
    </a>
  </h2>

  <div class="flex items-center text-sm font-semibold text-gray-600 dark:text-gray-300 space-x-3">
    <div title="Date Published">
      {% include "_pub_date.html" with pub_date=episode.pub_date %}
    </div>
    <div title="Duration">
      {{ duration|format_duration }}
    </div>
  </div>

  <div class="flex items-center space-x-3">
    <div>
      <a href="{{ podcast.get_absolute_url }}">
        {% include "podcasts/_cover_image.html" with size=24 %}
      </a>
    </div>
    <div class="space-y-2">
      {% include "episodes/_player_toggle.html" %}
      {% include "episodes/_download.html" %}
      {% share_buttons episode.get_absolute_url podcast.title|add:" | "|add:episode.title|stripentities %}
    </div>
  </div>

  {% if user.is_authenticated %}
  <div class="space-x-3 flex items-center">
    {% include "episodes/_queue_toggle.html" %}
    {% include "episodes/_favorite_toggle.html" %}
  </div>

  {% if episode.listened %}
  <div class="flex items-center space-x-3 border-t pt-3 dark:border-gray-500">
    {% include "episodes/_listened.html" %}

    {% if not is_playing %}
    {% include "episodes/_remove_audio_log.html" %}
    {% endif %}
  </div>
  {% endif %}
  {% endif %}

  {% if episode.explicit or podcast.explicit %}
  <div class="text-sm font-semibold">
    This episode may contain explicit content.
  </div>
  {% endif %}


  <blockquote class="markdown text-sm max-w-sm sm:max-w-full">
    {{ episode.description|clean_html }}
  </blockquote>

  {% include "podcasts/_disclaimer.html" %}

</section>
{% endwith %}
{% endblock %}
