{% load player %}
{% get_player as player %}
<div id="player"
     hx-preserve="true"
     x-data="playerData()"
     @close-player="console.log('CLOSEPLAYER')"
     @open-player="
        console.log('open player', $event.detail)
    ">
  {% if player %}
  {{ player|json_script:"player-info" }}
  {% endif %}
  <script>
    const defaults = {
      episode: null,
      podcast: null,
      currentTime: 0,
      isPlaying: false,
      isPaused: false,
    };
    function playerData() {
      const playerInfoTag = document.getElementById('player-info');
      if (playerInfoTag) {
        return {
          ...defaults,
          ...JSON.parse(playerInfoTag.textContent)
        };
      }
      return defaults;
    }
  </script>
  <template x-if="episode">
    <div class="fixed bottom-0 z-10 bg-black dark:bg-gray-800 text-white w-full px-2 py-1 font-semibold">
      <audio x-ref="audio"
             :src="episode.mediaUrl"
             :current-time="currentTime"
             preload="metadata">
      </audio>
      <div class="relative space-y-1">

        <div class="sm:hidden pr-1 text-sm w-84 text-center truncate">
          <a :href="episode.url"
             class="player--title"
             :title="episode.title"
             x-text="episode.title"></a>
        </div>

        <div class="flex items-center space-x-2 sm:space-x-1">

          <div>
            <a :href="podcast.url">
              <img class="object-cover border dark:border-gray-500 bg-transparent h-14 w-14 lg:h-18 lg:w-18 mr-2 self-center hover:opacity-75 border-white cursor-pointer"
                   title="podcast.title"
                   alt="podcast.title"
                   :width="podcast.coverImage.width"
                   :height="podcast.coverImage.height"
                   :src="podcast.coverImage.url">
            </a>
          </div>
          <div class="w-full space-y-1">

            <div class="flex justify-between items-center w-full">

              <div class="flex items-center">

                <button title="Pause"
                        data-toggle-target="item"
                        x-if="isPlaying"
                        x-ref="pause"
                        class="focus:outline-none hover:text-blue-500 mr-1">
                  {% icon "pause" css_class="h-8 w-8" %}
                </button>

                <button title="Play"
                        x-if="isPaused"
                        x-ref="play"
                        class="focus:outline-none hidden hover:text-blue-600 mr-1">
                  {% icon "play" css_class="h-8 w-8" %}
                </button>

                <form class="flex items-center"
                      method="POST"
                      action="{% url 'episodes:close_player' %}">
                  {% csrf_token %}
                  <button title="Stop"
                          class="focus:outline-none hover:text-blue-500 mr-1">
                    {% icon "stop" css_class="h-8 w-8" %}
                  </button>
                </form>

              </div>

              <div class="hidden sm:block text-sm text-center sm:w-64 w-96 lg:w-full truncate">
                <a :href="episode.url"
                   class="player--title"
                   title="episode.title"
                   x-text="episode.title"></a>
              </div>

              <div class="flex items-center">
                <button class="focus:outline-none mr-1 md:mr-2 p-1 hover:text-blue-500 player--interactive"
                        title="Decrease Playback Rate">-</button>
                <span class="mr-1 md:mr-2 tracking-tight leading-tight player--interactive text-sm"
                      data-player-target="playbackRate"
                      title="Playback Rate">
                  1.0x
                </span>
                <button class="focus:outline-none p-1 hover:text-blue-500 mr-3 player--interactive"
                        title="Increase Playback Rate">+</button>

                <button title="Skip back 10 seconds"
                        class="focus:outline-none hover:text-blue-500 player--interactive mr-2">
                  {% icon "skip_back_10" css_class="h-6 w-6" %}
                </button>
                <button title="Skip forward 10 seconds"
                        class="player--interactive focus:outline-none hover:text-blue-500 player--interactive">
                  {% icon "skip_forward_10" css_class="h-6 w-6" %}
                </button>
              </div>

            </div>

            <div class="flex items-center w-full mx-1">
              <div class="h-2 mx-auto rounded-full w-full flex items-center player--interactive player--progress"
                   data-action="click->player#skip mouseover->player#showPosition">
                <div class="w-4 h-4 rounded-full absolute border shadow-xl player--indicator"
                     style="z-index: 12;"></div>
              </div>
              <div class="w-20 mr-2 text-right tracking-tighter text-sm md:text-base player--counter">-00.00.00</div>
            </div>
          </div>
        </div>
      </div>
  </template>
</div>
