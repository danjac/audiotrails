{% load i18n static %}
{% with site_name=request.site.name %}
    <header class="sticky top-0 z-20 w-full text-white bg-black shadow"
        x-data="{showMenu: false, cloned: false}"
        x-init="{# fmt:off #}
            $watch('showMenu', (value) => {
                if (value && !cloned) {
                    $refs.menu.insertBefore(document.getElementById('sidebar').cloneNode(true), null);
                    htmx.process($refs.menu);
                    cloned = true;
                }
            });
        {# fmt:on #}"
        @htmx:before-request.window="showMenu=false">
        {% translate "Search" as t_search %}
        {% translate "Toggle Menu" as t_toggle_menu %}
        {% url 'podcasts:search_podcasts' as search_url %}
        <nav class="flex items-center justify-between p-2">
            <div class="flex items-center flex-shrink-0 space-x-3">
                <a class="inline-flex items-center text-lg font-bold md:text-xl xl:text-2xl hover:text-blue-300"
                    href="{% if user.is_authenticated %}{% url 'podcasts:index' %}{% else %}{% url 'podcasts:landing_page' %}{% endif %}"
                    title="{{ site_name }}: {% translate "Home Page" %}">
                    <img src="{% static 'img/wave.png' %}"
                        height="100"
                        width="100"
                        alt="{{ site_name }}"
                        class="w-6 h-6 mr-2 lg:h-8 lg:w-8"
                        title="{{ site_name }}"
                        aria-hidden="true">
                    {{ site_name }}
                </a>
            </div>
            <ul class="flex items-center space-x-3">
                {% if user.is_authenticated %}
                    <li>
                        <a href="{% url 'users:preferences' %}"
                            title="{% blocktranslate with username=user.username %}Settings for {{ username }}{% endblocktranslate %}"
                            class="flex items-center font-bold hover:text-blue-300">
                            {{ user.username|slice:12 }}
                        </a>
                    </li>
                    <li class="flex items-center xl:hidden">
                        <button class="focus:outline-none transform transition"
                            title="{{ t_toggle_menu }}"
                            x-cloak
                            x-show.transition="!showMenu"
                            @click="showMenu=true">
                            {% icon "bars" size="xl" title=t_toggle_menu %}
                        </button>
                        <button class="focus:outline-none transform transition"
                            title="{{ t_toggle_menu }}"
                            x-cloak
                            x-show.transition="showMenu"
                            @click="showMenu=false"
                            @keyup.escape.window="showMenu=false">
                            {% icon "chevron-down" size="xl" title=t_toggle_menu %}
                        </button>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'about' %}"
                            title="{% translate "About this Site" %}"
                            class="flex items-center font-bold space-x-2 hover:text-blue-300">
                            {% icon "info-circle" size="xl" %}
                            <span class="hidden md:inline-block">{% translate "About" %}</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        {% if user.is_authenticated %}
            <div class="absolute left-0 z-50 w-full py-6 bg-white shadow-xl xl:hidden dark:bg-black"
                x-cloak
                x-show.transition="showMenu && cloned"
                x-transition:enter="transition ease-out duration-100"
                x-transition:enter-start="transform opacity-0 scale-95"
                x-transition:enter-end="transform opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-75"
                x-transition:leave-start="transform opacity-100 scale-100"
                x-transition:leave-end="transform opacity-0 scale-95"
                x-ref="menu">
            </div>
        {% endif %}
        {% include "includes/signup_cta.html" %}
    </header>
{% endwith %}
