{% extends "podcasts/detail_base.html" %}
{% load cache heroicons partials %}
{% block podcast_content %}
    <article class="space-y-3">
        {% if podcast.owner %}<h2 class="text-lg font-semibold">{{ podcast.owner }}</h2>{% endif %}
        <div class="flex items-center space-x-3 sm:space-x-6">
            {% cover_image podcast.cover_url "md" podcast.cleaned_title css_class="h-40 w-40" %}
            <div class="flex flex-col place-content-between h-32">
                {% if podcast.private %}
                    <div>
                        {% if is_subscribed %}
                            <button class="inline-flex items-center btn btn-danger btn-lg"
                                    aria-label="Remove podcast from your private feeds"
                                    title="Remove podcast from your private feeds"
                                    hx-disabled-elt="this"
                                    hx-push-url="true"
                                    hx-confirm="Are you sure you want to remove this podcast from your Private Feeds? You can't undo this action!"
                                    hx-delete="{% url 'podcasts:remove_private_feed' podcast.pk %}"
                                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                                {% heroicon_mini "trash" class="mr-2" %}
                                Remove
                            </button>
                        {% else %}
                            <button class="inline-flex items-center btn btn-primary btn-lg"
                                    aria-label="This is a private feed, you cannot subscribe to it."
                                    title="This is a private feed, you cannot subscribe to it."
                                    disabled>
                                {% heroicon_mini "eye-slash" class="mr-2" %}
                                Subscribe
                            </button>
                        {% endif %}
                    </div>
                {% else %}
                    {% partialdef subscribe_button inline=True %}
                    <div id="subscribe-button"
                         hx-target="this"
                         hx-push-url="false"
                         hx-indicator="this"
                         hx-swap="outerHTML"
                         hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                        {% if is_subscribed %}
                            <button class="inline-flex items-center btn btn-primary btn-outline btn-lg"
                                    aria-label="Unsubscribe from this Podcast"
                                    title="Unsubscribe from this Podcast"
                                    hx-disabled-elt="this"
                                    hx-delete="{% url 'podcasts:unsubscribe' podcast.pk %}"
                                    hx-trigger="click once">
                                {% heroicon_mini "eye-slash" class="mr-2" %}
                                Unsubscribe
                            </button>
                        {% else %}
                            <button class="inline-flex items-center btn btn-primary btn-lg"
                                    aria-label="Subscribe to this Podcast"
                                    title="Subscribe to this Podcast"
                                    hx-disabled-elt="this"
                                    hx-post="{% url 'podcasts:subscribe' podcast.pk %}"
                                    hx-trigger="click once">
                                {% heroicon_mini "eye" class="mr-2" %}
                                Subscribe
                            </button>
                        {% endif %}
                    </div>
                {% endpartialdef subscribe_button %}
            {% endif %}
            <nav class="flex items-center space-x-3">
                {% if podcast.website %}
                    <div>
                        <a href="{{ podcast.website }}"
                           class="link"
                           rel="noopener nofollow"
                           target="_blank">Website</a>
                    </div>
                {% endif %}
                {% if is_subscribed or not podcast.private %}
                    <div>
                        <a href="{{ podcast.rss }}" class="link" target="_blank" download>RSS</a>
                    </div>
                {% endif %}
                {% if user.is_staff %}
                    <div>
                        <a href="{% url 'admin:podcasts_podcast_change' podcast.pk %}"
                           target="_blank"
                           hx-disable="true"
                           class="link">Admin</a>
                    </div>
                {% endif %}
            </nav>
            {% if podcast.pub_date %}
                <a href="{{ podcast.get_latest_episode_url }}"
                   class="inline-flex flex-wrap link">
                    {% include "_date.html" with value=podcast.pub_date title="Released" %}
                </a>
            {% endif %}
        </div>
    </div>
    {% if podcast.funding_url %}
        <div class="flex-wrap font-semibold">
            <a href="{{ podcast.funding_url }}"
               class="link"
               rel="noopener nofollow"
               target="_blank">{{ podcast.funding_text|default:'Support this podcast' }}</a>
        </div>
    {% endif %}
    {% cache 300 podcast-categories podcast.pk %}
    {% with categories=podcast.categories.all %}
        {% if categories %}
            <div class="flex flex-wrap items-center space-x-2 max-w-prose leading-loose sm:space-x-3"
                 x-data>
                {% for category in categories %}
                    <a class="inline-flex items-center link"
                       aria-label="{{ category.name }} Podcasts"
                       title="{{ category.name }} Podcasts"
                       href="{{ category.get_absolute_url }}">
                        {% heroicon_mini "tag" class="mr-2" %}
                        {{ category.name }}
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
{% endcache %}
{% markdown podcast.description %}
</article>
{% endblock podcast_content %}
