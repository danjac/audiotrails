{% extends "base.html" %}
{% load cache heroicons %}
{% block title %}
    {{ block.super }}| Search | iTunes
{% endblock title %}
{% block content %}
    <header class="justify-between items-center mb-3 space-y-3 sm:flex sm:mb-6 sm:space-y-0">
        <h1 class="flex justify-center items-center text-xl font-bold text-center sm:justify-start md:text-2xl xl:text-3xl sm:text-start">
            Search iTunes
        </h1>
        <nav>
            <ul class="items-center space-y-3 sm:flex sm:justify-end sm:space-y-0 sm:space-x-3">
                <li class="flex justify-center items-center sm:justify-end">
                    <a class="inline-flex items-center btn btn-default"
                       href="{% url "podcasts:search_podcasts" %}{{ request.search.qs }}">
                        {% heroicon_mini "magnifying-glass" class="mr-2" %}
                        Search Podcasts
                    </a>
                </li>
                <li class="flex justify-center items-center sm:justify-end">{% search_form "Search: Podcasts" %}</li>
            </ul>
        </nav>
    </header>
    {% cache CACHE_TIMEOUT search-itunes request.get_full_path %}
    <ul class="divide-y divide-solid">
        {% for feed in feeds %}
            {% if forloop.first %}
                <li class="pb-2 text-center sm:text-left">
                    Any new results returned from iTunes will be automatically added to our database.
                </li>
            {% endif %}
            <li class="py-3 first:pt-0 last:pb-0">
                {% if feed.podcast and feed.podcast.pub_date %}
                    {% include "podcasts/_podcast.html" with podcast=feed.podcast %}
                {% else %}
                    <div class="flex items-center space-x-3">
                        {% cover_image feed.image "sm" title=feed.title css_class="h-16 w-16" %}
                        <div class="flex flex-col place-content-between h-14">
                            <h2 class="font-bold tracking-tight leading-tight break-words line-clamp-2">{{ feed.title }}</h2>
                            <h3 class="w-60 text-xs font-semibold tracking-tight leading-tight text-gray-600 md:w-96 md:text-sm dark:text-gray-300 truncate">
                                <span class="animate-pulse">Adding podcast to database...</span>
                            </h3>
                        </div>
                    </div>
                {% endif %}
            </li>
        {% empty %}
            <li class="text-center sm:text-left">Sorry, no results found for your search.</li>
        {% endfor %}
    </ul>
{% endcache %}
{% endblock content %}
