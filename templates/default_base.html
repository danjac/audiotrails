{% spaceless %}
    {% load static capture_tags django_htmx heroicons audio_player %}
    {% capture as sidebar silent %}
    {% with SIDEBAR_CSS="inline-flex items-center w-full sm:w-auto link" ICON_CSS="mr-3 lg:mr-6" %}
        <nav class="pl-3 text-base xl:pl-0 xl:pt-12 md:text-lg lg:text-xl">
            <ul class="space-y-3 sm:space-y-0 xl:space-y-3 sm:grid sm:gap-3 sm:grid-flow-cols sm:grid-cols-2 xl:flex xl:flex-col xl:justify-content-between">
                <li>
                    <a href="{% url 'podcasts:index' %}"
                       accesskey="p"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "rss" class=ICON_CSS %}
                        Podcasts
                    </a>
                </li>
                <li>
                    <a href="{% url 'episodes:index' %}"
                       accesskey="n"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "sparkles" class=ICON_CSS %}
                        New Releases
                    </a>
                </li>
                <li>
                    <a href="{% url 'podcasts:category_list' %}"
                       accesskey="c"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "tag" class=ICON_CSS %}
                        Categories
                    </a>
                </li>
                <li>
                    <a href="{% url 'episodes:bookmarks' %}"
                       accesskey="b"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "bookmark" class=ICON_CSS %}
                        Bookmarks
                    </a>
                </li>
                <li>
                    <a href="{% url 'episodes:history' %}"
                       accesskey="h"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "clock" class=ICON_CSS %}
                        History
                    </a>
                </li>
                <li>
                    <a href="{% url 'podcasts:private_feeds' %}"
                       accesskey="f"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "lock-closed" class=ICON_CSS %}
                        Private Feeds
                    </a>
                </li>
                <li>
                    <a href="{% url 'users:preferences' %}"
                       accesskey="s"
                       class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "cog-6-tooth" class=ICON_CSS %}
                        Settings
                    </a>
                </li>
                <li>
                    <a href="{% url 'about' %}" accesskey="a" class="{{ SIDEBAR_CSS }}">
                        {% heroicon_outline "information-circle" class=ICON_CSS %}
                        About
                    </a>
                </li>
                <li>
                    <form class="{{ SIDEBAR_CSS }}"
                          hx-disable="true"
                          action="{% url 'account_logout' %}"
                          method="post">
                        {% csrf_token %}
                        <button accesskey="l" class="{{ SIDEBAR_CSS }}">
                            {% heroicon_outline "arrow-left-on-rectangle" class=ICON_CSS %}
                            Logout
                        </button>
                    </form>
                </li>
            </ul>
        </nav>
    {% endwith %}
{% endcapture %}
<!DOCTYPE html>
{% with site_name=request.site.name %}
    <html lang="en">
        <head>
            <title>{{ site_name }}
                {# djlint:off #}
                {% block title %}{% endblock title %}
                {# djlint:on #}
            </title>
            <link rel="icon" type="image/png" href="{% static 'img/wave-ico.png' %}">
            <link rel="apple-touch-icon" href="{% static 'img/apple-touch-icon.png' %}">
            <link rel="stylesheet" type="text/css" href="{% static "css/bundle.css" %}{% if debug %}?{% now "U" %}{% endif %}">
            <link rel="manifest" href="{% url 'manifest' %}">
            <link rel="canonical" href="https://{{ request.site.domain }}/">
            <meta charset="UTF-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport"
                  content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="copyright" content="Dan Jacob {% now "Y" %}">
            <meta name="cache-control" content="no-cache">
            <meta name="robots" content="index,follow">
            <meta name="description" content="Podcast aggregator site">
            <meta name="keywords" content="podcasts, rss, feeds">
            <meta name="theme-color" content="#041014">
        </head>
        <body class="mx-auto font-sans text-sm antialiased container-xl scroll-smooth md:text-base"
              hx-boost="true"
              hx-target="#content"
              hx-swap="innerHTML show:window:top"
              hx-indicator="#hx-indicator"
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
            {% include "_hx_indicator.html" %}
            <div class="flex flex-col h-screen">
                <div class="grow">
                    <header class="sticky top-0 z-20 w-full text-white bg-violet-900"
                            :class="scrolling ? 'drop-shadow-xl': ''"
                            x-data="{showMenu: false, scrolling: false}"
                            @scroll.window="scrolling = window.pageYOffset > 0"
                            @htmx:before-request.window="showMenu=false">
                        <nav class="flex items-center justify-between p-2">
                            <div class="flex items-center flex-shrink-0">
                                <a class="inline-flex items-center text-lg font-bold md:text-xl xl:text-2xl"
                                   href="{% if user.is_authenticated %}{% url 'podcasts:index' %}{% else %}{% url 'podcasts:landing_page' %}{% endif %}"
                                   title="{{ site_name }}: Home Page">
                                    <img src="{% static 'img/wave-white.png' %}"
                                         height="100"
                                         width="100"
                                         alt="{{ site_name }}"
                                         class="w-6 h-6 mr-3 lg:h-8 lg:w-8"
                                         title="{{ site_name }}"
                                         aria-hidden="true">
                                    {{ site_name }}
                                </a>
                            </div>
                            <ul class="flex items-center space-x-3">
                                {% if user.is_authenticated %}
                                    <li>
                                        <a href="{% url 'users:preferences' %}"
                                           aria-label="Settings for {{ user.username }}"
                                           title="Settings for {{ user.username }}"
                                           class="flex items-center font-bold">{{ user.username|slice:12 }}</a>
                                    </li>
                                    <li class="flex items-center xl:hidden">
                                        <button class="focus:outline-none transform transition"
                                                aria-label="Show Menu"
                                                title="Show Menu"
                                                x-cloak
                                                x-show.transition="!showMenu"
                                                @click="showMenu=true">
                                            {% heroicon_outline "bars-3" size=30 title="Toggle Menu" %}
                                        </button>
                                        <button class="focus:outline-none transform transition"
                                                aria-label="Hide Menu"
                                                title="Hide Menu"
                                                x-cloak
                                                x-show.transition="showMenu"
                                                @click="showMenu=false"
                                                @keyup.escape.window="showMenu=false">
                                            {% heroicon_outline "x-mark" size=30 title="Toggle Menu" %}
                                        </button>
                                    </li>
                                {% else %}
                                    <li>
                                        <a href="{% url 'about' %}"
                                           aria-label="About this Site"
                                           title="About this Site"
                                           class="flex items-center font-bold space-x-2 hover:text-blue-300">
                                            {% heroicon_outline "information-circle" size=30 title="Toggle Menu" %}
                                            <span class="hidden md:inline-block">About</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% if user.is_authenticated %}
                            <div class="absolute left-0 z-50 w-full py-6 bg-white shadow-xl xl:hidden dark:bg-black"
                                 x-cloak
                                 x-show.transition="showMenu"
                                 x-transition:enter="transition ease-out duration-75"
                                 x-transition:enter-start="transform opacity-0 scale-95"
                                 x-transition:enter-end="transform opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="transform opacity-100 scale-100"
                                 x-transition:leave-end="transform opacity-0 scale-95">{{ sidebar }}</div>
                        {% endif %}
                        {% include "_signup_cta.html" %}
                    </header>
                {% endwith %}
                {% include "_messages.html" %}
                <div class="relative flex min-h-screen p-2 py-6 xl:pt-12 mx-auto xl:w-11/12">
                    {% if user.is_authenticated %}
                        <aside class="hidden w-full xl:block xl:w-1/5 xl:sticky xl:h-full xl:top-28">
                            {{ sidebar }}
                        </aside>
                    {% endif %}
                    <main class="w-full mx-auto xl:block xl:w-4/5" id="content" hx-history-elt>
                        {# djlint:off #}
                            {% block content %}{% endblock content %}
                        {# djlint:on #}
                    </main>
                </div>
                {% if user.is_authenticated %}
                    {% audio_player %}
                {% else %}
                    {% cookie_notice %}
                {% endif %}
            </div>
        </div>
        {% django_htmx_script %}
        <script defer src="{% static "js/bundle.js" %}{% if debug %}?{% now "U" %}{% endif %}"></script>
        <script>
                if (typeof navigator.serviceWorker !== 'undefined') {
                    navigator.serviceWorker.register('{% url "service_worker" %}')
                }
        </script>
    </body>
</html>
{% endspaceless %}
