{% load audio_player django_htmx partials static tailwind_cli %}
{% spaceless %}
    <!DOCTYPE html>
    <html lang="en">
        <head>
            <title>
                {% block title %}
                    {{ request.site.name }}
                {% endblock title %}
            </title>
            {% include "partials.html#head" %}
        </head>
        <body class="mx-auto font-sans antialiased container-xl scroll-smooth"
              hx-boost="true"
              hx-target="#content"
              hx-swap="innerHTML show:window:top"
              hx-indicator="#hx-indicator">
            <div id="hx-indicator"
                 x-data="{width: 0}"
                     {# fmt:off #}
                     x-init="
                        setInterval(() => {
                            if ($el.classList.contains('htmx-request')) {
                                width = width + (Math.random() / 100) + 1;
                                width = width > 30 ? width = -30 : width;
                            } else {
                                width = 0;
                            }
                            $el.style.width = width > 0 ? `${10 + (width * 90)}%` : '0px';
                    }, 36);"{# fmt:on #}></div>
            {% include "partials.html#messages" %}
            <div class="flex flex-col h-screen">
                <div class="grow">
                    <c-navbar />
                    <div class="flex relative py-6 px-2 mx-auto min-h-screen">
                        {% if user.is_authenticated %}
                            <aside class="hidden w-full xl:block xl:sticky xl:top-20 xl:w-1/6 xl:h-full">
                                <nav>
                                    <c-navbar.menu />
                                </nav>
                            </aside>
                        {% endif %}
                        <main class="mx-auto w-full xl:w-5/6" id="content" hx-history-elt>
                            {% block content %}
                            {% endblock content %}
                        </main>
                    </div>
                </div>
                <c-audio-player :audio-log="request.player.audio_log" />
                {% include "partials.html#cookie_banner" %}
            </div>
            {% include "partials.html#scripts" %}
        </body>
    </html>
{% endspaceless %}
